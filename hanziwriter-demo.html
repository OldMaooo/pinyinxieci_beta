<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HanziWriter ç¬”é¡ºæ¼”ç¤º</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
        }
        h1 {
            margin: 0 0 1rem 0;
            color: #333;
            text-align: center;
        }
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        @media (max-width: 900px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
        }
        .left-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }
        .input-section {
            width: 100%;
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
        }
        #char-input {
            padding: 0.75rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 0.5rem;
            font-size: 1.2rem;
            width: 4rem;
            text-align: center;
        }
        #char-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .button-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            max-width: 400px;
        }
        button {
            padding: 0.6rem 1.2rem;
            border: 2px solid #e0e0e0;
            border-radius: 0.5rem;
            background: white;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        button:hover {
            background: #f8f9fa;
            transform: translateY(-1px);
        }
        button.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        #character-target {
            width: 400px;
            height: 400px;
            border: 3px solid #333;
            border-radius: 1rem;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .control-group {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid #e0e0e0;
        }
        .control-group h3 {
            margin: 0 0 1rem 0;
            color: #333;
            font-size: 1rem;
        }
        .toggle-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        .toggle-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .toggle-group input[type="checkbox"] {
            width: 1.2rem;
            height: 1.2rem;
            cursor: pointer;
        }
        .color-presets {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-top: 1rem;
        }
        .color-preset {
            padding: 0.5rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 0.5rem;
            background: white;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .color-preset:hover {
            border-color: #667eea;
            background: #f0f3ff;
        }
        .color-preset .swatch {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.2);
        }
        .status-bar {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e0e0e0;
            margin-top: 1rem;
            min-height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: #555;
        }
        .preset-chars {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .preset-char {
            padding: 0.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 0.5rem;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 1.2rem;
            transition: all 0.2s;
        }
        .preset-char:hover {
            border-color: #667eea;
            background: #f0f3ff;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–Œï¸ HanziWriter ç¬”é¡ºæ¼”ç¤º</h1>
        
        <div class="demo-grid">
            <div class="left-panel">
                <div class="input-section">
                    <input type="text" id="char-input" value="æˆ‘" maxlength="1" placeholder="å­—">
                    <button id="load-btn">åŠ è½½</button>
                </div>
                
                <div class="button-grid">
                    <button id="animate-btn">â–¶ï¸ æ’­æ”¾ç¬”é¡º</button>
                    <button id="animate-once-btn">å•ç¬”æ’­æ”¾</button>
                    <button id="quiz-btn">âœï¸ å¼€å§‹ç»ƒä¹ </button>
                    <button id="reset-btn">ğŸ”„ é‡ç½®</button>
                </div>
                
                <div id="character-target"></div>
                
                <div class="status-bar" id="status-bar">
                    é€‰æ‹©ä¸€ä¸ªæ±‰å­—å¼€å§‹
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <h3 style="margin: 0 0 0.5rem 0; color: #333;">å¿«é€Ÿé€‰æ‹©å¸¸ç”¨å­—ï¼š</h3>
                    <div class="preset-chars" id="preset-chars">
                        <!-- å¸¸ç”¨å­—å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="control-group">
                    <h3>æ˜¾ç¤ºé€‰é¡¹</h3>
                    <div class="toggle-group">
                        <label>
                            <input type="checkbox" id="show-outline">
                            æ˜¾ç¤ºè½®å»“
                        </label>
                        <label>
                            <input type="checkbox" id="show-radical">
                            æ˜¾ç¤ºéƒ¨é¦–
                        </label>
                        <label>
                            <input type="checkbox" id="show-stroke-animation">
                            ç¬”ç”»åŠ¨ç”»
                        </label>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>åŠ¨ç”»è®¾ç½®</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.9rem; color: #555;">
                        <label>
                            ç¬”ç”»é€Ÿåº¦: <span id="stroke-speed-val">1.0</span>x
                            <input type="range" id="stroke-speed" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
                        </label>
                        <label>
                            ç¬”ç”»é—´éš”: <span id="stroke-delay-val">200</span>ms
                            <input type="range" id="stroke-delay" min="50" max="1000" step="50" value="200" style="width: 100%;">
                        </label>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>ç¬”ç”»é¢œè‰²æ–¹æ¡ˆ</h3>
                    <div class="color-presets">
                        <div class="color-preset" data-preset="default">
                            <div class="swatch" style="background: #333;"></div>
                            é»˜è®¤é»‘è‰²
                        </div>
                        <div class="color-preset" data-preset="radical">
                            <div class="swatch" style="background: linear-gradient(135deg, #333 50%, #DC2626 50%);"></div>
                            éƒ¨é¦–çº¢è‰²
                        </div>
                        <div class="color-preset" data-preset="rainbow">
                            <div class="swatch" style="background: linear-gradient(90deg, #EF4444, #F59E0B, #10B981, #3B82F6, #8B5CF6);"></div>
                            å½©è™¹æ¸å˜
                        </div>
                        <div class="color-preset" data-preset="by-position">
                            <div class="swatch" style="background: linear-gradient(135deg, #EF4444 33%, #3B82F6 66%, #10B981 100%);"></div>
                            æŒ‰ä½ç½®åŒºåˆ†
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let writer = null;
        const charInput = document.getElementById('char-input');
        const target = document.getElementById('character-target');
        const statusBar = document.getElementById('status-bar');
        const loadBtn = document.getElementById('load-btn');
        const animateBtn = document.getElementById('animate-btn');
        const animateOnceBtn = document.getElementById('animate-once-btn');
        const quizBtn = document.getElementById('quiz-btn');
        const resetBtn = document.getElementById('reset-btn');
        const presetCharsDiv = document.getElementById('preset-chars');
        
        // å¸¸ç”¨æ±‰å­—
        const COMMON_CHARS = 'æˆ‘ä½ ä»–å¥¹ä»¬å¥½æ˜¯çš„ç€äº†è¿™ä¸Šä¸‹æœ‰æ¥å»åœ°å¤§å­å°å¤šä¹Ÿå¤©äººéƒ½åœ¨æ—¶å€™ä¼šå¯ä»¥è¦é‚£å“ªå‘¢æ„æ€äº›åˆ«è¿™ä¹ˆæ ·ä»€ä¹ˆå‘€å§';
        
        // æ˜¾ç¤ºé€‰é¡¹
        const showOutline = document.getElementById('show-outline');
        const showRadical = document.getElementById('show-radical');
        const showStrokeAnimation = document.getElementById('show-stroke-animation');
        
        // åŠ¨ç”»è®¾ç½®
        const strokeSpeed = document.getElementById('stroke-speed');
        const strokeDelay = document.getElementById('stroke-delay');
        const strokeSpeedVal = document.getElementById('stroke-speed-val');
        const strokeDelayVal = document.getElementById('stroke-delay-val');
        
        // åˆå§‹åŒ–é¢„è®¾å­—ç¬¦æŒ‰é’®
        COMMON_CHARS.split('').forEach(char => {
            const btn = document.createElement('div');
            btn.className = 'preset-char';
            btn.textContent = char;
            btn.onclick = () => {
                charInput.value = char;
                loadCharacter();
            };
            presetCharsDiv.appendChild(btn);
        });
        
        // åˆå§‹åŒ– HanziWriter
        function initWriter(char) {
            target.innerHTML = '';
            updateStatus(`æ­£åœ¨åŠ è½½ "${char}" çš„ç¬”é¡ºæ•°æ®...`);
            
                try {
                    writer = HanziWriter.create('character-target', char, {
                        width: 350,
                        height: 350,
                        padding: 10,
                        showOutline: showOutline.checked,
                        showCharacter: false,
                        strokeAnimationSpeed: parseFloat(strokeSpeed.value),
                        delayBetweenStrokes: parseInt(strokeDelay.value),
                        strokeColor: '#333',
                        radicalColor: '#333',
                        outlineColor: '#DDD',
                        strokeHighlightSpeed: 20,
                        outlineAnimationSpeed: 1000,
                        onLoadCharDataError: function(reason) {
                            const errorMsg = reason || 'æœªçŸ¥é”™è¯¯';
                            updateStatus(`åŠ è½½å¤±è´¥: ${errorMsg}`, true);
                            writer = null;
                        },
                        onLoadCharDataSuccess: function() {
                            // ç®€å•æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
                            updateStatus(`"${char}" åŠ è½½æˆåŠŸï¼`, false);
                        }
                    });
                } catch (err) {
                    updateStatus(`åˆå§‹åŒ–å¤±è´¥: ${err.message}`, true);
                    writer = null;
                }
                                } catch (e) {
                                    updateStatus(`"${char}" åŠ è½½æˆåŠŸï¼Œä½†è¯»å–æ•°æ®å¤±è´¥: ${e.message}`, false);
                                }
                            }, 100);
                        }
                                    } else if (writer.character) {
                                        // ç›´æ¥éå†å­—ç¬¦å¯¹è±¡å¯»æ‰¾æ•°ç»„
                                        for (let key in writer.character) {
                                            if (Array.isArray(writer.character[key])) {
                                                strokeCount = writer.character[key].length;
                                                break;
                                            }
                                        }
                                    }
                                    }
                                    updateStatus(`"${char}" åŠ è½½æˆåŠŸï¼ç¬”ç”»æ•°: ${strokeCount}`, false);
                                } catch (e) {
                                    updateStatus(`"${char}" åŠ è½½æˆåŠŸï¼Œä½†è¯»å–ç¬”ç”»æ•°å¤±è´¥: ${e.message}`, false);
                                }
                            }, 100);
                        }
                    });
                } catch (err) {
                    updateStatus(`åˆå§‹åŒ–å¤±è´¥: ${err.message}`, true);
                    writer = null;
                }
        }
        
        // æ›´æ–° Writer é€‰é¡¹ï¼ˆä¸åŒ…æ‹¬é¢œè‰²æ–¹æ¡ˆï¼‰
        function updateWriterOptions() {
            if (!writer) return;

            writer.option('showOutline', showOutline.checked);
            writer.option('showCharacter', showRadical.checked);
            writer.option('strokeAnimationSpeed', parseFloat(strokeSpeed.value));
            writer.option('delayBetweenStrokes', parseInt(strokeDelay.value));
        }
        
        // åº”ç”¨é¢œè‰²æ–¹æ¡ˆ
        function applyColorScheme(preset) {
            if (!writer || !writer.character || !writer.character.strokes) return;

            const strokes = writer.character.strokes;

            if (preset === 'default') {
                writer.option('strokeColor', '#333');
                writer.option('radicalColor', '#333');
                writer.setCharacter();
            } else if (preset === 'radical') {
                // ç®€å•å‡è®¾å‰ä¸¤ç¬”æ˜¯éƒ¨é¦–ï¼ˆå®é™…æƒ…å†µéœ€è¦æ›´å¤æ‚çš„é€»è¾‘ï¼‰
                writer.option('strokeColor', '#333');
                writer.option('radicalColor', '#DC2626');
                writer.setCharacter();
            } else if (preset === 'rainbow') {
                // å½©è™¹è‰²
                const colors = ['#EF4444', '#F59E0B', '#10B981', '#3B82F6', '#8B5CF6'];
                const strokeRanges = {};
                const segmentSize = Math.ceil(strokes.length / colors.length);
                for (let i = 0; i < strokes.length; i++) {
                    const colorIndex = Math.floor(i / segmentSize);
                    strokeRanges[i] = { color: colors[colorIndex] };
                }
                writer.setCharacter({ strokeData: strokeRanges });
            } else if (preset === 'by-position') {
                // æŒ‰ä½ç½®åŒºåˆ†ï¼ˆç®€åŒ–ç‰ˆï¼šå‰1/3å·¦ï¼Œå2/3å³ï¼‰
                const strokeRanges = {};
                const leftColor = '#EF4444';
                const rightColor = '#3B82F6';
                for (let i = 0; i < strokes.length; i++) {
                    strokeRanges[i] = {
                        color: i < strokes.length / 3 ? leftColor : rightColor
                    };
                }
                writer.setCharacter({ strokeData: strokeRanges });
            }
        }
        
        // åŠ è½½å­—ç¬¦
        function loadCharacter() {
            const char = charInput.value.trim();
            if (!char) {
                updateStatus('è¯·è¾“å…¥ä¸€ä¸ªæ±‰å­—', true);
                return;
            }
            initWriter(char);
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message, isError = false) {
            statusBar.textContent = message;
            statusBar.style.color = isError ? '#DC2626' : '#555';
            statusBar.style.background = isError ? '#FEE2E2' : '#F8F9FA';
        }
        
        // äº‹ä»¶ç»‘å®š
        loadBtn.onclick = loadCharacter;
        
        animateBtn.onclick = () => {
            if (writer) {
                updateStatus('æ­£åœ¨æ’­æ”¾ç¬”é¡º...');
                writer.animateCharacter(() => {
                    updateStatus('ç¬”é¡ºæ’­æ”¾å®Œæˆ');
                });
            }
        };
        
        animateOnceBtn.onclick = () => {
            if (writer) {
                updateStatus('æ­£åœ¨æ’­æ”¾ä¸‹ä¸€ç¬”...');
                writer.animateStroke(() => {
                    updateStatus('å•ç¬”æ’­æ”¾å®Œæˆ');
                });
            }
        };
        
        quizBtn.onclick = () => {
            if (writer) {
                updateStatus('è¯·åœ¨æ–¹æ¡†å†…ä¹¦å†™è¯¥æ±‰å­—...', false);
                writer.quiz({
                    onMistake: function(strokeNum, stroke) {
                        updateStatus(`ç¬¬ ${strokeNum + 1} ç¬”å†™é”™äº†ï¼Œè¯·é‡è¯•`, true);
                    },
                    onCorrectStroke: function(strokeNum, stroke) {
                        updateStatus(`ç¬¬ ${strokeNum + 1} ç¬”æ­£ç¡®ï¼`);
                    },
                    onComplete: function(summaryData) {
                        const percentage = Math.round(summaryData.totalMistakes / summaryData.totalStrokes * 100);
                        let message = 'å¤ªæ£’äº†ï¼ä¹¦å†™å®Œæˆ';
                        if (summaryData.totalMistakes > 0) {
                            message = `ä¹¦å†™å®Œæˆï¼é”™è¯¯ ${summaryData.totalMistakes} æ¬¡`;
                        }
                        updateStatus(message);
                        writer.showOutline();
                    }
                });
            }
        };
        
        resetBtn.onclick = () => {
            if (writer) {
                const char = charInput.value.trim();
                initWriter(char);
                updateStatus('å·²é‡ç½®');
            }
        };
        
        // æ˜¾ç¤ºé€‰é¡¹å˜åŒ–
        showOutline.onchange = updateWriterOptions;
        showRadical.onchange = updateWriterOptions;
        showStrokeAnimation.onchange = updateWriterOptions;
        
        // åŠ¨ç”»è®¾ç½®å˜åŒ–
        strokeSpeed.oninput = function() {
            strokeSpeedVal.textContent = this.value;
            updateWriterOptions();
        };
        strokeDelay.oninput = function() {
            strokeDelayVal.textContent = this.value;
            updateWriterOptions();
        };
        
        // é¢œè‰²æ–¹æ¡ˆåˆ‡æ¢
        document.querySelectorAll('.color-preset').forEach(preset => {
            preset.onclick = function() {
                document.querySelectorAll('.color-preset').forEach(p => p.classList.remove('active'));
                this.classList.add('active');
                applyColorScheme(this.dataset.preset);
                updateStatus(`å·²åº”ç”¨é¢œè‰²æ–¹æ¡ˆ: ${this.textContent.trim().split('\n')[0]}`);
            };
        });

        // ä¸è®¾ç½®é»˜è®¤é¢œè‰²æ–¹æ¡ˆï¼Œç­‰ç”¨æˆ·ç‚¹å‡»æ—¶æ‰åº”ç”¨
        
        // å›è½¦é”®åŠ è½½
        charInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadCharacter();
            }
        });
        
        // åˆå§‹åŒ–é»˜è®¤å­—ç¬¦
        initWriter('æˆ‘');
    </script>
</body>
</html>
