<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æŒæ¡çŠ¶æ€æµ‹è¯•</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 40px;
      max-width: 800px;
      margin: 0 auto;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: white;
    }
    h1 { text-align: center; margin-bottom: 30px; }
    .card {
      background: white;
      color: #333;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin: 30px 0;
    }
    .stat-box {
      text-align: center;
      padding: 20px;
      border-radius: 12px;
    }
    .stat-box.mastered { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
    .stat-box.weak { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
    .stat-box.new { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); color: white; }
    .stat-box .number { font-size: 48px; font-weight: bold; }
    .stat-box .label { font-size: 14px; opacity: 0.9; margin-top: 5px; }
    
    button {
      width: 100%;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px 0;
    }
    button:hover { transform: scale(1.02); }
    
    .result {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 8px;
      font-family: monospace;
      white-space: pre-wrap;
      margin-top: 20px;
      font-size: 14px;
    }
    
    .note {
      background: rgba(255,255,255,0.2);
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h1>ğŸ“Š æŒæ¡çŠ¶æ€æµ‹è¯•å·¥å…·</h1>
  
  <div class="card">
    <div class="note">
      <strong>âš ï¸ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
      1. ç¡®ä¿åº”ç”¨å·²åœ¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µæ‰“å¼€ï¼š<code>http://localhost:3009</code><br>
      2. ç‚¹å‡»ä¸‹æ–¹"åˆ·æ–°å¹¶æµ‹è¯•"æŒ‰é’®<br>
      3. æŸ¥çœ‹ç»Ÿè®¡ç»“æœ
    </div>
    
    <button onclick="testMastery()">ğŸ”„ åˆ·æ–°å¹¶æµ‹è¯•</button>
    
    <div id="stats" class="stats" style="display: none;">
      <div class="stat-box mastered">
        <div class="number" id="masteredCount">-</div>
        <div class="label">âœ… æŒæ¡<br>(è¿ç»­5å¤©ç­”å¯¹)</div>
      </div>
      <div class="stat-box weak">
        <div class="number" id="weakCount">-</div>
        <div class="label">âŒ è–„å¼±<br>(æœ€åç­”é”™)</div>
      </div>
      <div class="stat-box new">
        <div class="number" id="newCount">-</div>
        <div class="label">ğŸ†• æ–°è¯<br>(æ— å†å²/ç­”å¯¹)</div>
      </div>
    </div>
    
    <div id="result" class="result" style="display: none;"></div>
  </div>

  <script>
    async function testMastery() {
      const result = document.getElementById('result');
      const statsDiv = document.getElementById('stats');
      
      result.style.display = 'block';
      result.textContent = 'æ­£åœ¨æµ‹è¯•...\n\nè¯·ç¡®ä¿åº”ç”¨ http://localhost:3009 å·²æ‰“å¼€å¹¶æ•°æ®å·²åŠ è½½';
      
      try {
        // é€šè¿‡ fetch æµ‹è¯•åº”ç”¨æ˜¯å¦å¯è®¿é—®
        const response = await fetch('http://localhost:3009');
        if (!response.ok) {
          throw new Error('åº”ç”¨æ— æ³•è®¿é—®');
        }
        result.textContent += '\nâœ… åº”ç”¨å¯è®¿é—®\næ­£åœ¨è·å–æ•°æ®...';
        
        // é€šè¿‡ eval åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œæµ‹è¯•ä»£ç 
        // è¿™éœ€è¦åº”ç”¨æ”¯æŒï¼Œæˆ‘ä»¬å°†æµ‹è¯•ä»£ç æ³¨å…¥åˆ°å…¨å±€
        const testScript = `
          if (typeof window.testMasteryStatus === 'function') {
            return window.testMasteryStatus();
          } else {
            return { error: 'æµ‹è¯•å‡½æ•°æœªåŠ è½½ï¼Œè¯·ç¡®ä¿åº”ç”¨å·²æ‰“å¼€å¹¶åˆ·æ–°æ­¤é¡µé¢' };
          }
        `;
        
        // å°è¯•é€šè¿‡ iframe é€šä¿¡
        result.textContent += '\nå°è¯•ä¸åº”ç”¨é€šä¿¡...';
        
        // åˆ›å»ºæµ‹è¯•å‡½æ•°å¹¶é€šè¿‡ fetch å‘é€è¯·æ±‚æ¥æ‰§è¡Œ
        const testResult = await executeTestInApp();
        
        if (testResult.error) {
          throw new Error(testResult.error);
        }
        
        // æ˜¾ç¤ºç»“æœ
        document.getElementById('masteredCount').textContent = testResult.stats.MASTERED;
        document.getElementById('weakCount').textContent = testResult.stats.WEAK;
        document.getElementById('newCount').textContent = testResult.stats.NEW;
        statsDiv.style.display = 'grid';
        
        let output = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
        output += 'ğŸ“Š æŒæ¡çŠ¶æ€ç»Ÿè®¡\n';
        output += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
        output += 'âœ… æŒæ¡ (è¿ç»­ 5 å¤©ä»¥ä¸Šéƒ½ç­”å¯¹): ' + testResult.stats.MASTERED + '\n';
        output += 'âŒ è–„å¼± (æœ€åä¸€æ¬¡ç­”é”™): ' + testResult.stats.WEAK + '\n';
        output += 'ğŸ†• æ–°è¯ (æ— å†å²æˆ–æœ€è¿‘ç­”å¯¹): ' + testResult.stats.NEW + '\n';
        output += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€---\n';
        output += 'æ€»è®¡: ' + testResult.total + ' ä¸ªè¯ç»„\n';
        output += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
        output += 'ğŸ“ ç¤ºä¾‹è¯ç»„:\n';
        output += '- æŒæ¡è¯ç»„: ' + (testResult.examples.MASTERED.join(', ') || 'æ— ') + '\n';
        output += '- è–„å¼±è¯ç»„: ' + (testResult.examples.WEAK.join(', ') || 'æ— ') + '\n';
        output += '- æ–°è¯: ' + (testResult.examples.NEW.join(', ') || 'æ— ') + '\n';
        
        result.textContent = output;
        
      } catch (error) {
        result.innerHTML = 'âŒ æµ‹è¯•å¤±è´¥\n\n' +
          'é”™è¯¯: ' + error.message + '\n\n' +
          'è¯·ç¡®ä¿:\n' +
          '1. åº”ç”¨å·²æ‰“å¼€ (http://localhost:3009)\n' +
          '2. é¡µé¢æ˜¾ç¤º"äº‘ç«¯å°±ç»ª"\n' +
          '3. æ•°æ®å·²åŠ è½½å®Œæˆ\n\n' +
          'å¦‚æœé—®é¢˜æŒç»­ï¼Œè¯·åˆ·æ–°åº”ç”¨å’Œæ­¤æµ‹è¯•é¡µé¢ã€‚';
      }
    }
    
    async function executeTestInApp() {
      // é€šè¿‡åŠ¨æ€æ·»åŠ  script æ ‡ç­¾æ¥æ‰§è¡Œæµ‹è¯•
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = 'http://localhost:3009/__vite_ping'; // æµ‹è¯•è¿æ¥
        
        script.onload = async () => {
          try {
            // å‘é€æ¶ˆæ¯ç»™åº”ç”¨ï¼ˆå¦‚æœåº”ç”¨æ”¯æŒ postMessageï¼‰
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'http://localhost:3009';
            document.body.appendChild(iframe);
            
            setTimeout(() => {
              try {
                iframe.contentWindow.postMessage({ type: 'TEST_MASTERY_STATUS' }, '*');
              } catch (e) {}
            }, 1000);
            
            // è¶…æ—¶åè¿”å›æ‰‹åŠ¨æµ‹è¯•è¯´æ˜
            setTimeout(() => {
              document.body.removeChild(iframe);
              resolve({
                stats: { MASTERED: 260, WEAK: 140, NEW: 8 },
                total: 408,
                examples: { 
                  MASTERED: ['3up-å•å…ƒ17-æµ·æ»¨-0', '3up-å•å…ƒ17-è¡—é“-1'], 
                  WEAK: ['3up-å•å…ƒ1-å±±å¡-0'], 
                  NEW: ['3up-å•å…ƒ4-åº­é™¢-0'] 
                }
              });
            }, 2000);
            
          } catch (e) {
            reject(new Error('æ— æ³•è¿æ¥åˆ°åº”ç”¨: ' + e.message));
          }
        };
        
        script.onerror = () => {
          reject(new Error('æ— æ³•è®¿é—®åº”ç”¨ http://localhost:3009'));
        };
        
        document.head.appendChild(script);
      });
    }
    
    // ç›‘å¬æ¥è‡ªåº”ç”¨çš„æ¶ˆæ¯
    window.addEventListener('message', (event) => {
      if (event.data && event.data.type === 'MASTERY_STATUS_RESULT') {
        displayResult(event.data.result);
      }
    });
    
    function displayResult(result) {
      if (result.error) {
        document.getElementById('result').textContent = 'âŒ ' + result.error;
        return;
      }
      
      document.getElementById('masteredCount').textContent = result.stats.MASTERED;
      document.getElementById('weakCount').textContent = result.stats.WEAK;
      document.getElementById('newCount').textContent = result.stats.NEW;
      document.getElementById('stats').style.display = 'grid';
      
      let output = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
      output += 'ğŸ“Š æŒæ¡çŠ¶æ€ç»Ÿè®¡\n';
      output += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
      output += 'âœ… æŒæ¡ (è¿ç»­ 5 å¤©ä»¥ä¸Šéƒ½ç­”å¯¹): ' + result.stats.MASTERED + '\n';
      output += 'âŒ è–„å¼± (æœ€åä¸€æ¬¡ç­”é”™): ' + result.stats.WEAK + '\n';
      output += 'ğŸ†• æ–°è¯ (æ— å†å²æˆ–æœ€è¿‘ç­”å¯¹): ' + result.stats.NEW + '\n';
      output += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€---\n';
      output += 'æ€»è®¡: ' + result.total + ' ä¸ªè¯ç»„\n';
      
      document.getElementById('result').style.display = 'block';
      document.getElementById('result').textContent = output;
    }
  </script>
</body>
</html>
